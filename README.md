# Genome-on-Diet: RL-Based Sparsification Pattern Selection

This repository contains a reinforcement learning (RL) framework for automatically selecting optimal sparsification patterns for Illumina short read mapping using Genome-on-Diet.

## Overview

Genome-on-Diet uses sparsification patterns to reduce computational cost by only considering a subset of positions in sequences. This RL project trains an agent (PPO) to automatically select the best sparsification pattern based on dataset characteristics, balancing speed and accuracy.

**Original Genome-on-Diet paper**: Alser et al. (2022) - [arXiv:2211.08157](https://arxiv.org/abs/2211.08157)

## Quick Start

### 1. Build GDiet (Short Reads)

```bash
cd GDiet-ShortReads
make
cd ..
```

### 2. Prepare Multi-Chromosome Datasets

```bash
# Step 2a: Split full genome into chromosome files
python3 rl/scripts/split_genome_by_chromosome.py \
    --chromosomes chr1 chr2 chr3 chr4 chr5 chr21 chr22 chrX

# Step 2b: Extract chromosome-specific reads (one-time setup)
# First, you need a SAM file from mapping the full FASTQ to full genome
# Then extract reads by chromosome:
python3 rl/scripts/extract_chromosome_reads.py \
    --sam-file <path-to-your-sam-file> \
    --input-fastq Data/D1_S1_L001_R1_001-017_small.fastq \
    --output-dir Data/chromosome_reads
```

### 3. Train RL Model

```bash
# Install dependencies
pip install -r rl/requirements.txt

# Train with multi-chromosome datasets
python3 rl/ppo_train.py \
    --config rl/configs/env_multi_chromosome.yaml \
    --timesteps 200
```

### 4. Evaluate Model

```bash
python3 rl/evaluate_model.py \
    --config rl/configs/env_multi_chromosome.yaml \
    --n-episodes 20 \
    --compare-baseline
```

## Directory Structure

```
Genome-on-Diet/
├── GDiet-ShortReads/          # Genome-on-Diet executable for Illumina short reads
│   └── GDiet                  # Main executable (used by RL environment)
├── Data/                       # Datasets for RL training
│   ├── chromosomes/           # Individual chromosome FASTA files
│   ├── D1_S1_L001_R1_001-017_small.fastq  # Query reads (1,000 reads, included)
│   └── [Large files excluded - see Data/README.md for download instructions]
│       # GCA_000001405.15_GRCh38_no_alt_analysis_set.fasta (2.9GB - download separately)
│       # D1_S1_L001_R1_001-017.fastq (24MB - download separately)
│       # chromosome_reads/*.fastq (generated by scripts)
├── rl/                        # RL framework code
│   ├── envs/                  # Gymnasium environment
│   ├── configs/                # Configuration files
│   ├── scripts/                # Utility scripts
│   ├── models/                 # Trained models
│   └── ppo_train.py           # Training script
├── SPARSIFICATION_PATTERNS.md  # Pattern documentation
└── LICENSE                    # License file
```

## RL Project Details

See `rl/README.md` and `rl/TRAINING_EXPLANATION.md` for detailed documentation on:
- Environment architecture
- Observation space (dataset features)
- Reward function
- Training configuration
- Multi-chromosome setup

## Key Features

- **Pattern Generation**: Policy network generates sparsification patterns (length 6) instead of selecting from a fixed set
- **Context-Aware**: Model sees dataset characteristics (read count, read length, reference size, GC content) before generating patterns
- **Multi-Chromosome Training**: Trains on multiple chromosomes with different sizes for better generalization
- **Chromosome-Specific Reads**: Each episode uses reads from one chromosome mapped to that chromosome's reference
- **Balanced Optimization**: Learns to balance speed (runtime) and accuracy (mapping rate, edit distance)

## Sparsification Patterns

Patterns are strings of '1's and '0's where:
- `'1'` = Keep this position
- `'0'` = Skip this position

Example patterns:
- `"10"` (W=2): 50% sparsification (keep every other base)
- `"110"` (W=3): 67% sparsification (keep 2 out of 3 bases)
- `"1110"` (W=4): 75% sparsification (keep 3 out of 4 bases)

See `SPARSIFICATION_PATTERNS.md` for detailed documentation.

## Citing

If you use this RL framework, please cite:

**Original Genome-on-Diet**:
```bibtex
@article{Genome-on-Diet2022,
    author = {Alser, Mohammed and Eudine, Julien and Mutlu, Onur},
    title = "{Taming Large-Scale Genomic Analyses via Sparsified Genomics}",
    year = {2022},
}
```

## License

See `LICENSE` file for details.
